define("block_coupon/coupons/bulkactions",["exports","jquery","core/notification","core/str","core/toast","block_coupon/coupons/service","core_table/dynamic","core_form/modalform"],(function(_exports,_jquery,Notification,Str,_toast,_service,DynamicTable,_modalform){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),Notification=_interopRequireWildcard(Notification),Str=_interopRequireWildcard(Str),DynamicTable=_interopRequireWildcard(DynamicTable),_modalform=_interopRequireDefault(_modalform);const SELECTORS_checkbox='[data-action="bulk"]',SELECTORS_bulkactionselect='[data-type="bulkaction"]',SELECTORS_bulkcounter="#bulk-counter",SELECTORS_bulkactions={container:'[data-region="bulkactions"]',delete:'[data-action="bulkdelete"]',editcourses:'[data-action="editcourses"]',editcohorts:'[data-action="editcohorts"]'},enableBulkActions=enable=>{enable?document.querySelector(SELECTORS_bulkactionselect).removeAttribute("disabled"):document.querySelector(SELECTORS_bulkactionselect).setAttribute("disabled","disabled")},handleCheckboxChange=()=>{let size=(0,_jquery.default)("".concat(SELECTORS_checkbox,":checked")).length;if((0,_jquery.default)(SELECTORS_bulkcounter).html("".concat(size)),enableBulkActions(size>0),size>0){let types=getSelectedTypes();if(document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcourses)).classList.remove("hidden"),document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcohorts)).classList.add("hidden"),types.length>1)document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcourses)).classList.add("hidden"),document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcohorts)).classList.add("hidden");else{let typ=types[0];"cohort"===typ&&document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcohorts)).classList.remove("hidden"),"course"===typ&&document.querySelector("".concat(SELECTORS_bulkactions.container," ").concat(SELECTORS_bulkactions.editcourses)).classList.remove("hidden")}}},getSelectedIds=()=>{let boxes=(0,_jquery.default)("".concat(SELECTORS_checkbox,":checked")),ids=[];return boxes.each(((idx,el)=>{ids.push(el.dataset.id)})),ids},getSelectedTypes=()=>{let boxes=(0,_jquery.default)("".concat(SELECTORS_checkbox,":checked")),typs=[];return boxes.each(((idx,el)=>{typs.push(el.dataset.typ)})),Array.from(new Set(typs))},checkTypes=async()=>{if(getSelectedTypes().length>1){let args=await Str.get_strings([{key:"err:bulkaction:typ:diff:title",component:"block_coupon"},{key:"err:bulkaction:typ:diff:msg",component:"block_coupon"},{key:"ok"}]);return Notification.alert(...args),!1}return!0},bulkDelete=async e=>{if(await checkTypes()){e.preventDefault();(0,_jquery.default)(e.currentTarget).attr("data-id");Str.get_strings([{key:"confirm",component:"moodle"},{key:"deletecouponsconfirm",component:"block_coupon"},{key:"deletecoupons",component:"block_coupon"},{key:"cancel",component:"moodle"}]).done((function(s){Notification.confirm(s[0],s[1],s[2],s[3],(async()=>{let ids=getSelectedIds(),rs=await _service.Service.deleteCoupons(ids);rs.result?((0,_toast.add)(rs.msg,{type:"success"}),setTimeout((()=>{window.location.reload()}),750)):(0,_toast.add)(rs.msg,{type:"error"})}))})).fail(Notification.exception)}},bulkEditCourses=async e=>{if(await checkTypes()){console.log("bulk editcourses ".concat(getSelectedIds())),e.preventDefault();let mfArgs={};if(void 0!==e.currentTarget.dataset.jArgs){let jArgs=e.currentTarget.dataset.jArgs;"string"==typeof jArgs&&(jArgs=JSON.parse(jArgs));for(const[key,value]of Object.entries(jArgs))mfArgs[key]=value}mfArgs.id=getSelectedIds();const modalForm=new _modalform.default({formClass:"block_coupon\\forms\\dynamic\\editcourses",modalConfig:{title:Str.get_string("editcourses","block_coupon")},args:mfArgs,returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>window.location.reload())),modalForm.show()}},bulkEditCohorts=async e=>{if(await checkTypes()){console.log("bulk editcohorts ".concat(getSelectedIds())),e.preventDefault();let mfArgs={};if(void 0!==e.currentTarget.dataset.jArgs){let jArgs=e.currentTarget.dataset.jArgs;"string"==typeof jArgs&&(jArgs=JSON.parse(jArgs));for(const[key,value]of Object.entries(jArgs))mfArgs[key]=value}mfArgs.id=getSelectedIds();const modalForm=new _modalform.default({formClass:"block_coupon\\forms\\dynamic\\editcohorts",modalConfig:{title:Str.get_string("editcohorts","block_coupon")},args:mfArgs,returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>window.location.reload())),modalForm.show()}};_exports.init=()=>{enableBulkActions((0,_jquery.default)("".concat(SELECTORS_checkbox,":checked")).length>0),(0,_jquery.default)(SELECTORS_checkbox).on("change",handleCheckboxChange),(0,_jquery.default)(SELECTORS_bulkactions.container).on("click",SELECTORS_bulkactions.delete,bulkDelete),(0,_jquery.default)(SELECTORS_bulkactions.container).on("click",SELECTORS_bulkactions.editcourses,bulkEditCourses),(0,_jquery.default)(SELECTORS_bulkactions.container).on("click",SELECTORS_bulkactions.editcohorts,bulkEditCohorts)}}));

//# sourceMappingURL=bulkactions.min.js.map